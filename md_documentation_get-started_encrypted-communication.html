<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Virgil SDK: Encrypted Communication</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Virgil SDK
   &#160;<span id="projectnumber">4.3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Encrypted Communication </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="#head1">Set Up Server</a> | <a href="#head2">Set Up Clients</a> | <a href="#head3">Register Users</a> | <a href="#head4">Sign &amp; Encrypt</a> | <a href="#head5">Decrypt &amp; Verify</a></p>
<h2>Introduction</h2>
<p>It is very easy to encrypt data for secure communications in a few easy steps. In this tutorial, we will be helping two people communicate with full (end-to-end) encryption.</p>
<p>Due to limited time and resources, developers often resort to third-party solutions to transfer data, which do not have an open source API, a full cycle of data security that would ensure integrity and confidentiality, thus, all of your data could be read by the third party. <a class="el" href="namespace_virgil.html">Virgil</a> offers a solution without these weaknesses.</p>
<div class="image">
<img src="/documentation/img/encrypted_communication_intro.png"  alt="Encrypted Communication"/>
</div>
<p>See our tutorial on <a href="https://github.com/VirgilSecurity/virgil-demo-twilio">Virgil &amp; Twilio Programmable Chat</a> for best practices.</p>
<h2><a class="anchor" id="head1"></a> Set Up Server</h2>
<p>Your server should be able to authorize your users, store Application's <a class="el" href="namespace_virgil.html">Virgil</a> Key and use <a class="el" href="namespace_virgil.html">Virgil</a> SDK for cryptographic operations or for some requests to <a class="el" href="namespace_virgil.html">Virgil</a> Services. You can configure your server using the /documentation/guides/configuration/server.md "Setup Guide".</p>
<h2><a class="anchor" id="head2"></a> Set Up Clients</h2>
<p>Set up the client-side to provide your users with an access token after their registration at your Application Server to authenticate them for further operations and transmit their <a class="el" href="namespace_virgil.html">Virgil</a> Cards to the server. Configure the client-side using the /documentation/guides/configuration/client.md "Setup Guide".</p>
<h2><a class="anchor" id="head3"></a> Register Users</h2>
<p>Now you need to register the users who will participate in encrypted communications.</p>
<p>In order to sign and encrypt a message each user must have his own tools, which allow him to perform cryptographic operations, and these tools must contain the necessary information to identify users. In <a class="el" href="namespace_virgil.html">Virgil</a> Security, these tools are the <a class="el" href="namespace_virgil.html">Virgil</a> Key and the <a class="el" href="namespace_virgil.html">Virgil</a> Card.</p>
<div class="image">
<img src="/documentation/img/Card_introduct.png"  alt="Virgil Card" title="Create Virgil Card"/>
</div>
<p>When we have already set up the <a class="el" href="namespace_virgil.html">Virgil</a> SDK on the server &amp; client sides, we can finally create <a class="el" href="namespace_virgil.html">Virgil</a> Cards for the users and transmit the Cards to your Server for further publication on <a class="el" href="namespace_virgil.html">Virgil</a> Services.</p>
<h3>Generate Keys and Create <a class="el" href="namespace_virgil.html">Virgil</a> Card</h3>
<p>Use the <a class="el" href="namespace_virgil.html">Virgil</a> SDK on the client side to generate a new Key Pair, and then create a user's <a class="el" href="namespace_virgil.html">Virgil</a> Card using the recently generated <a class="el" href="namespace_virgil.html">Virgil</a> Key. All keys are generated and stored on the client side.</p>
<p>In this example, we will pass on the user's username and a password, which will lock in their private encryption key. Each <a class="el" href="namespace_virgil.html">Virgil</a> Card is signed by a user's <a class="el" href="namespace_virgil.html">Virgil</a> Key, which guarantees the <a class="el" href="namespace_virgil.html">Virgil</a> Card's content integrity over its life cycle.</p>
<div class="fragment"><div class="line"><span class="comment">// generate a new Virgil Key</span></div><div class="line">var aliceKey = virgil.Keys.Generate();</div><div class="line"></div><div class="line"><span class="comment">// save the Virgil Key into storage</span></div><div class="line">aliceKey.Save(<span class="stringliteral">&quot;[KEY_NAME]&quot;</span>, <span class="stringliteral">&quot;[KEY_PASSWORD]&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// create a Virgil Card</span></div><div class="line">var aliceCard = virgil.Cards.Create(<span class="stringliteral">&quot;alice&quot;</span>, aliceKey);</div></div><!-- fragment --><p>Warning: <a class="el" href="namespace_virgil.html">Virgil</a> doesn't keep a copy of your <a class="el" href="namespace_virgil.html">Virgil</a> Key. If you lose a <a class="el" href="namespace_virgil.html">Virgil</a> Key, there is no way to recover it.</p>
<p>To send a message, Sender needs a <a class="el" href="namespace_virgil.html">Virgil</a> Card associated with the Recipient. Note: Recently created user <a class="el" href="namespace_virgil.html">Virgil</a> Cards are visible only for application users because they are related to the Application.</p>
<h3>Transmit the Cards to Your Server</h3>
<p>Next, you must serialize and transmit these Cards to your server, where you will Approve &amp; Publish Users' Cards.</p>
<div class="fragment"><div class="line"><span class="comment">// export a Virgil Card to string</span></div><div class="line">var exportedCard = aliceCard.Export();</div><div class="line"></div><div class="line"><span class="comment">// transmit the Virgil Card to the server</span></div><div class="line">TransmitToServer(exportedCard);</div></div><!-- fragment --><h2><a class="anchor" id="head4"></a> Sign &amp; Encrypt a Message</h2>
<p>With the user's Cards in place, we are now ready to encrypt a message for encrypted communication. In this case, we will encrypt the message using the Recipient's <a class="el" href="namespace_virgil.html">Virgil</a> Card.</p>
<p>As previously noted we encrypt data for secure communication, but a recipient also must be sure that no third party modified any of the message's content and that they can trust a sender, which is why we provide Data Integrity by adding a Digital Signature. Therefore we must digitally sign data first and then encrypt.</p>
<div class="image">
<img src="/documentation/img/Guides_introduction.png"  alt="Virgil Intro"/>
</div>
<p>In order to sign then encrypt messages, the Sender must load their own recently generated <a class="el" href="namespace_virgil.html">Virgil</a> Key and search for the receiver's <a class="el" href="namespace_virgil.html">Virgil</a> Cards at <a class="el" href="namespace_virgil.html">Virgil</a> Services, where all <a class="el" href="namespace_virgil.html">Virgil</a> Cards are saved.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// load a Virgil Key from device storage</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;var aliceKey = virgil.Keys.Load(&quot;[KEY_NAME]&quot;, &quot;[OPTIONAL_KEY_PASSWORD]&quot;);</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;// search for Virgil Cards</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;var bobCards = await virgil.Cards.FindAsync(&quot;bob&quot;);</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;// prepare the message</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;var message = &quot;Hey Bob, how&#39;s it going?&quot;;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;// sign and encrypt the message</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;var ciphertext = aliceKey.SignThenEncrypt(message, bobCards)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    .ToString(StringEncoding.Base64);</div></div><!-- fragment --><p>To sign a message, you will need to load Alice's <a class="el" href="namespace_virgil.html">Virgil</a> Key.</p>
<p>Now the Receiver can verify that the message was sent by a specific Sender.</p>
<h3>Transmission</h3>
<p>With the signature in place, the Sender is now ready to transmit the signed and encrypted message to the Receiver.</p>
<p>See our tutorial on <a href="https://github.com/VirgilSecurity/virgil-demo-twilio">Virgil &amp; Twilio Programmable Chat</a> for best practices.</p>
<h2><a class="anchor" id="head5"></a> Decrypt a Message &amp; Verify its Signature</h2>
<p>Once the Recipient receives the signed and encrypted message, he can decrypt and validate the message. Thus, proving that the message has not been tampered with, by verifying the signature against the Sender's <a class="el" href="namespace_virgil.html">Virgil</a> Card.</p>
<p>In order to decrypt the encrypted message and then verify the signature, we need to load a private receiver's <a class="el" href="namespace_virgil.html">Virgil</a> Key and search for the sender's <a class="el" href="namespace_virgil.html">Virgil</a> Card at <a class="el" href="namespace_virgil.html">Virgil</a> Services.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// load a Virgil Key from device storage</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;var bobKey = virgil.Keys.Load(&quot;[KEY_NAME]&quot;, &quot;[OPTIONAL_KEY_PASSWORD]&quot;);</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;// get a sender&#39;s Virgil Card</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;var aliceCard = await virgil.Cards.Get(&quot;[ALICE_CARD_ID]&quot;);</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;// decrypt the message</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;var originalMessage = bobKey.DecryptThenVerify(ciphertext, aliceCard).ToString();</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
